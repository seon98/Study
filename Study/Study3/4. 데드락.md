# Deadlock (교착 상태)

## 1. Deadlock이란?

**Deadlock**이란, 두 개 이상의 프로세스가 서로 자원을 점유한 상태로 상대방의 자원을 기다리며 **무한 대기**에 빠지는 상황을 의미한다. 이 상태가 되면 어느 누구도 작업을 더 이상 진행할 수 없게 된다.

---

## 2. Deadlock 발생 조건 (Coffman Conditions)

Deadlock은 다음의 4가지 조건이 **동시에 만족**될 때 발생한다:

| 조건 | 설명 |
|------|------|
| 상호 배제 (Mutual Exclusion) | 한 번에 하나의 프로세스만 자원을 사용할 수 있음 |
| 점유와 대기 (Hold and Wait) | 자원을 점유한 상태에서 다른 자원을 요청함 |
| 비선점 (No Preemption) | 점유한 자원을 강제로 빼앗을 수 없음 |
| 순환 대기 (Circular Wait) | 프로세스들이 자원을 순환적으로 대기하고 있음 |

> 이 중 하나라도 **충족되지 않으면** Deadlock은 발생하지 않는다.

---

## 3. Deadlock 해결 전략

### 3.1 예방 (Prevention)

Deadlock의 4가지 조건 중 **하나 이상을 무력화**시켜 발생을 방지하는 방식

- **상호 배제 제거**: 자원을 동시에 여러 프로세스가 사용할 수 있도록 설계
- **점유와 대기 차단**: 프로세스는 필요한 모든 자원을 한 번에 요청하도록 제한
- **비선점 허용**: 자원이 필요한 프로세스가 우선순위가 높다면 강제로 회수
- **순환 대기 방지**: 자원 요청 순서를 미리 정해 순환 대기 방지

> 단점: 시스템 유연성/성능 저하 가능

---

### 3.2 회피 (Avoidance)

- **Deadlock이 발생하지 않는 안전 상태(Safe State)**만 허용
- 자원 할당 전에 시스템이 안전 상태인지 시뮬레이션 수행
- 대표 알고리즘: **Banker’s Algorithm (은행원 알고리즘)**

#### 은행원 알고리즘 핵심 개념

| 항목 | 설명 |
|------|------|
| Max | 각 프로세스가 요구할 수 있는 최대 자원량 |
| Allocation | 현재 프로세스에 할당된 자원량 |
| Need | 남은 요구량 = Max - Allocation |
| Available | 시스템이 현재 보유 중인 자원량 |

→ 모든 프로세스를 일정 순서대로 종료할 수 있다면 Safe Sequence

> 단점: 사전에 최대 요구량을 알아야 하며, 자원 할당 유연성 저하

---

### 3.3 탐지 및 회복 (Detection & Recovery)

Deadlock이 **이미 발생한 뒤** 탐지하고 해결하는 방식

#### 탐지 방법

- Allocation, Request, Available 상태표를 바탕으로 시뮬레이션
- 자원 할당 그래프(Resource Allocation Graph)를 통한 순환 탐지

#### 회복 방법

- **프로세스 종료**
  - Deadlock에 포함된 프로세스를 전부 또는 일부 종료
- **자원 선점**
  - 프로세스에게 할당된 자원을 회수하여 Deadlock을 해소

> 단점: 작업 손실, 시스템 부담 발생 가능

---

## 4. Deadlock 상태 예시

예: 시스템에 총 12개의 자원이 있고, 아래와 같이 프로세스들이 자원을 사용 중이라 가정

| 프로세스 | Max | Allocation | Need |
|----------|-----|------------|------|
| P0       | 10  | 5          | 5    |
| P1       | 4   | 2          | 2    |
| P2       | 9   | 2          | 7    |

Available = 12 - (5+2+2) = 3

### 안전 순서 찾기: `<P1 → P0 → P2>`

1. P1이 2개 더 할당받고 종료 → 2+2 반환 → Available = 5
2. P0이 5개 더 받아 종료 → 5+5 반환 → Available = 10
3. P2가 7개 받아 종료 → 2+7 반환 → Available = 12

→ Safe State 성립

---

## 5. 요약

| 전략 | 설명 | 장단점 |
|------|------|--------|
| 예방 (Prevention) | Deadlock 조건 중 하나를 제거 | 단순하지만 비효율적 |
| 회피 (Avoidance) | Safe 상태만 유지하도록 자원 할당 | 은행원 알고리즘 등, 예측 기반 |
| 탐지 및 회복 | 발생 후 탐지하여 프로세스 종료 또는 자원 선점 | 시스템 오버헤드 크고 복잡 |

---

## 6. 참고

- *Operating System Concepts*, Silberschatz et al.
- *Modern Operating Systems*, Andrew S. Tanenbaum
- GeeksforGeeks: [https://www.geeksforgeeks.org/deadlock-in-operating-system](https://www.geeksforgeeks.org/deadlock-in-operating-system)
